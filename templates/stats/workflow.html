{% extends "base.html" %} 
{% load static from staticfiles %}
{% block head_js %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/3.0.6/dc.js"></script>
<script type="text/javascript" src="{% static 'js/queue.min.js'%}"></script>
<!--<script type="text/javascript" src="{% static 'js/workflow_stats.js' %}"></script>-->
<script type="text/javascript">
queue()
    .defer(d3.json, "stats/api/data/")
    .await(this.makeGraphs);
    

    this.makeGraphs = function(error, data) {
        var ndx = crossfilter(data);

        var dtgFormat = d3.time.format("%Y-%m-%d");
        //Data Parsing
        data.forEach(function(d) {
            d.time_spent_mins = d.time_spent_mins;
            d.timestamp = dtgFormat.parse(d.timestamp);

        });
        console.log(data);
        this.show_time_spent_per_bug(ndx);
        dc.renderAll();
    }
        //Pie Chart Participation By Country
        this.show_time_spent_per_bug = function(ndx) {
            
            var bugDimension = ndx.dimension(dc.pluck("bug__title"));
            var bugGroup = bugDimension.group().reduceSum(dc.pluck("time_spent_mins"));
            
            dc.pieChart("#time-spent-per-bug")
                .height(220)
                .radius(100)
                .transitionDuration(1500)
                .dimension(bugDimension)
                .group(bugGroup);
            
         }

</script>
{% endblock %}

{% block content %}
<h1>Stats</h1>

<select id="myDropDown">
  <option value="Infinity">All</option>
  <option value='30'>30 days</option>
  <option value='7'>7 days</option>
  <option value="2">Top 2 day</option>
  <option value="5">Top 5 day</option>
</select>

<br>

 <div class=" col-xs-12 col-lg-4">
                <div class="chart-wrapper">
                    <div class="chart-title">Lifetime Score by Country</div>
                    <div id="time-spent-per-bug" class="chart-stage"  style="font-weight: normal" ></div>

                    
                    <p>This is the share of players lifetime points shared by their countries of origin. Japan is clearly dominates the sport followed in second by the United States.</p>
                </div>
            </div>
            
            


{% endblock %}